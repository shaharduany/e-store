CREATE TABLE genre (
    id SERIAL PRIMARY KEY,
    name TEXT UNIQUE
);

CREATE TABLE roles (
    id SERIAL PRIMARY KEY,
    role VARCHAR(256) UNIQUE
);

CREATE TABLE product (
    id SERIAL,
    name VARCHAR(256) UNIQUE,
    description text,
    price float,
    genre INTEGER REFERENCES genre,
    image TEXT,
    PRIMARY KEY(id)
);

CREATE TABLE purchases (
    id SERIAL,
    date DATE DEFAULT NOW(),
    products INTEGER [],
    buyer INTEGER REFERENCES public.users,
    PRIMARY KEY(id)
);

CREATE TABLE public.users
(
    id serial,
    username varchar(64),
    display_name varchar(64),
    email varchar(126),
    pwd_hash varchar(32),
    pwd_salt varchar(32),
    external_type varchar(16),
    external_id varchar(64),
    history INTEGER [],
    role INTEGER REFERENCES roles,
    PRIMARY KEY (id)
)
WITH (
    OIDS = FALSE
);

CREATE TABLE public.access_tokens
(
    id serial,
    access_token text,
    user_id INTEGER REFERENCES users,
    PRIMARY KEY (id)
)
WITH (
    OIDS = FALSE
);
